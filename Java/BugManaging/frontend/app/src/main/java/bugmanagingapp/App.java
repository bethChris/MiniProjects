/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package bugmanagingapp;

import java.io.IOException;
import java.io.InputStream;
import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.util.List;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;

public class App implements Runnable {
    public void run(){
        show();
    }

    public void show(){
        JFrame frame = new JFrame("Bug Manager");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(500,500);
        
        JPanel recentUnresolvedPanel = new JPanel();
        JPanel recentResolvedPanel = new JPanel();

        JPanel viewAllPanel = new JPanel();
        JButton button1 = new JButton("View All");
        
        viewAllPanel.add(button1);
        button1.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // Call the function you want to execute
                listReports();
            }
        });

        frame.getContentPane().add(BorderLayout.SOUTH, viewAllPanel);
        frame.getContentPane().add(BorderLayout.CENTER, recentUnresolvedPanel);
        frame.getContentPane().add(BorderLayout.CENTER, recentResolvedPanel);

        frame.setVisible(true);
    }
    

    public void listReports() {      
        HttpClient httpClient = HttpClient.newHttpClient();  
        HttpRequest request = HttpRequest.newBuilder(URI.create(Utils.USER_API)).GET().build();  
        try {  
            HttpResponse<InputStream> response = httpClient.send(request, HttpResponse.BodyHandlers.ofInputStream());  
    
            int statusCode = response.statusCode();  
            System.out.println("HTTP status: " + statusCode);  
    
            System.out.println("Reports returned in request: ");  
            List<Report> reports = Utils.toList(response.body());  
            reports.forEach(System.out::println);  
    
            System.out.println("Headers:");  
            response.headers().map().forEach((header, value) -> System.out.println(header + " = " + String.join(", ", value)));  
        }  
        catch (IOException | InterruptedException e) {  
            throw new RuntimeException(e);  
        }  
    }
    
    public static void main(String[] args) {
        SwingUtilities.invokeLater(new App());
        
    }
}
